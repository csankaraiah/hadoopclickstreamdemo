/* Clean up script */ 

drop table products;
drop table consumers;
drop table Products_URL;
drop table User_WebID;

drop table omniturelog;
drop view omniture;
drop table GMI_webloganalytics;

drop table weather_gmi_dy;
drop table weather_gmi_dy1;

drop table gmi_tweet;
drop table gmi_tweet_count;
drop table gmi_tweet_analysis;

*/


show tables;



select * from products_url;


select * from user_webid;

select * from omniture;

select 
to_date(o.ts) logdate, 
o.url, 
o.ip, 
o.city, 
upper(o.state) state, 
o.country, 
p.productid, 
CAST(datediff( from_unixtime( unix_timestamp() ), 
from_unixtime( unix_timestamp(u.birth_dt, 'dd-MMM-yy'))) / 365  AS INT) age,
u.gender_flg gender 
from omniture o inner join Products_URL p on o.url = p.url_id 
    left outer join User_WebID u on o.swid = concat('{', u.swid , '}')
    


create external table weather_gmi_dy(variables array<string>)
ROW FORMAT DELIMITED
    COLLECTION ITEMS TERMINATED BY ','
LOCATION '/user/hive/weather_data';


select variables[7],variables[6] from  weather_gmi_dy;





create external table if not exists weather_gmi_dy1 
( yearmonth bigint,
  episode_id bigint,
  event_id bigint,
  location_index bigint,
  range1 double,
  azimuth string,
  location string,
  latitude double,
  longitude double,
  lat2 bigint,
  lon2 bigint) 
  row format delimited fields terminated by ',' 
  location '/user/hive/weather_data';
  
  
  select * from weather_gmi_dy1 
  
  
  
  CREATE TABLE gmi_tweet (
  tweet_spout string,
  tweet_stream string,
  tweet_userid string,
  tweet_txt1 string,
  tweet_txt2 string,
  tweet_txt3 string,
  tweet_txt4 string)
ROW FORMAT DELIMITED
  FIELDS TERMINATED BY ',';
  
  
  
  
  LOAD DATA INPATH '/user/hive/tweets0812.txt' INTO TABLE gmi_tweet;
  
  create table gmi_tweet_count as 
select gmi_tweet_word, count(*) as tweet_cnt from gmi_tweet_analysis 
group by gmi_tweet_word;
  
  
  create table gmi_tweet_analysis as 
SELECT gmi_tweet_word
FROM gmi_tweet LATERAL VIEW explode(split(tweet_txt1, ' ')) wd AS gmi_tweet_word 
where lower(gmi_tweet_word) not in ('a',
'about',
'above',
'across',
'after',
'afterwards',
'again',
'against',
'all',
'almost',
'alone',
'along',
'already',
'also',
'although',
'always',
'am',
'among',
'amongst',
'amoungst',
'amount',
'an',
'and',
'another',
'any',
'anyhow',
'anyone',
'anything',
'anyway',
'anywhere',
'are',
'around',
'as',
'at',
'back',
'be',
'became',
'because',
'become',
'becomes',
'becoming',
'been',
'before',
'beforehand',
'behind',
'being',
'below',
'beside',
'besides',
'between',
'beyond',
'bill',
'both',
'bottom',
'but',
'by',
'call',
'can',
'cannot',
'cant',
'co',
'computer',
'con',
'could',
'couldnt',
'cry',
'de',
'describe',
'detail',
'do',
'done',
'down',
'due',
'during',
'each',
'eg',
'eight',
'either',
'eleven',
'else',
'elsewhere',
'empty',
'enough',
'etc',
'even',
'ever',
'every',
'everyone',
'everything',
'everywhere',
'except',
'few',
'fifteen',
'fify',
'fill',
'find',
'fire',
'first',
'five',
'for',
'former',
'formerly',
'forty',
'found',
'four',
'from',
'front',
'full',
'further',
'get',
'give',
'go',
'had',
'has',
'hasnt',
'have',
'he',
'hence',
'her',
'here',
'hereafter',
'hereby',
'herein',
'hereupon',
'hers',
'herse"',
'him',
'himse"',
'his',
'how',
'however',
'hundred',
'i',
'ie',
'if',
'in',
'inc',
'indeed',
'interest',
'into',
'is',
'it',
'its',
'itse"',
'keep',
'last',
'latter',
'latterly',
'least',
'less',
'ltd',
'made',
'many',
'may',
'me',
'meanwhile',
'might',
'mill',
'mine',
'more',
'moreover',
'most',
'mostly',
'move',
'much',
'must',
'my',
'myse"',
'name',
'namely',
'neither',
'never',
'nevertheless',
'next',
'nine',
'no',
'nobody',
'none',
'noone',
'nor',
'not',
'nothing',
'now',
'nowhere',
'of',
'off',
'often',
'on',
'once',
'one',
'only',
'onto',
'or',
'other',
'others',
'otherwise',
'our',
'ours',
'ourselves',
'out',
'over',
'own',
'part',
'per',
'perhaps',
'please',
'put',
'rather',
're',
'same',
'see',
'seem',
'seemed',
'seeming',
'seems',
'serious',
'several',
'she',
'should',
'show',
'side',
'since',
'sincere',
'six',
'sixty',
'so',
'some',
'somehow',
'someone',
'something',
'sometime',
'sometimes',
'somewhere',
'still',
'such',
'system',
'take',
'ten',
'than',
'that',
'the',
'their',
'them',
'themselves',
'then',
'thence',
'there',
'thereafter',
'thereby',
'therefore',
'therein',
'thereupon',
'these',
'they',
'thick',
'thin',
'third',
'this',
'those',
'though',
'three',
'through',
'throughout',
'thru',
'thus',
'to',
'together',
'too',
'top',
'toward',
'towards',
'twelve',
'twenty',
'two',
'un',
'under',
'until',
'up',
'upon',
'us',
'very',
'via',
'was',
'we',
'well',
'were',
'what',
'whatever',
'when',
'whence',
'whenever',
'where',
'whereafter',
'whereas',
'whereby',
'wherein',
'whereupon',
'wherever',
'whether',
'which',
'while',
'whither',
'who',
'whoever',
'whole',
'whom',
'whose',
'why',
'will',
'with',
'within',
'without',
'would',
'yet',
'you',
'your',
'yours',
'yourself',
'yourselves');



